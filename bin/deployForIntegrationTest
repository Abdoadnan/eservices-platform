#!/bin/bash
# simple script to be used for running integration tests.
# creates a deployment based on the current time 
function usage () {
  echo "Usage: $1 "
  exit 1 ;
}

ERRORSTATUS=0
if [ $# != 0 ]
then
 usage $0
fi
pushd $HOME/workspaces/inheritsource-develop/pawap/bin 
# try to stop any running deployment
./motrice_services.sh stop 

# create a new one 
DEPLOYMENTNAME="${HOME}/motrice"`date  +%Y%m%d%H%M`
cp current_config.sh current_config.sh.orig 
cat current_config.sh.orig | sed  s%'CONTAINER_ROOT=.*'%CONTAINER_ROOT=${DEPLOYMENTNAME}%g > current_config.sh
./create-new-deploy-environment.sh
./deploy-inherit-platform.sh
popd 

exit ${ERRORSTATUS}
